<!doctype html>
<html lang="de" class="h-full bg-gray-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adelboden-Lenk • Sillerenbühl – Überblick (Webcams, Wetter, Tarife, Anlagen, Schnee, Pisten)</title>
  <meta name="description" content="Mobile Übersicht für das Skigebiet Adelboden-Lenk (Sillerenbühl): Webcams, aktuelles Wetter & Prognose, Tarife, geöffnete Anlagen, Schneebericht & Pisten. Reines HTML/JS – keine DB, kein Server." />
  <link rel="preconnect" href="https://api.open-meteo.com" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { /* utility via Tailwind at runtime */ }
    .section-title { /* utility via Tailwind at runtime */ }
    .badge { /* utility via Tailwind at runtime */ }
    .skeleton { background: linear-gradient(90deg,#f2f2f2 25%,#e6e6e6 37%,#f2f2f2 63%); background-size:400% 100%; animation: shine 1.2s ease-in-out infinite; }
    @keyframes shine { 0%{background-position:100% 0} 100%{background-position:-100% 0} }
    iframe{ border:0; }
    .sticky-top { position: sticky; top: 0; z-index: 40; backdrop-filter: blur(6px); }
  </style>
</head>
<body class="h-full text-slate-900">
  <!-- Header -->
  <header class="sticky-top bg-white/80 border-b border-slate-200">
    <div class="max-w-3xl mx-auto px-4 py-2 flex items-center gap-3 relative">
      <div class="w-8 h-8 rounded-xl bg-sky-100 flex items-center justify-center">⛷️</div>
      <div class="flex-1">
        <div class="text-sm font-semibold leading-tight">Adelboden‑Lenk • Sillerenbühl</div>
        <div class="text-xs text-slate-500">Schneller Überblick: Webcams · Wetter · Tarife · Anlagen · Schnee · Pisten</div>
      </div>
      <a href="#" id="refreshBtn" class="text-xs bg-slate-900 text-white px-3 py-1 rounded-full">Aktualisieren</a>
      <details class="ml-2">
        <summary class="text-xs cursor-pointer px-2 py-1 rounded-full border">⚙️ Daten</summary>
        <div class="absolute right-2 mt-2 w-[92vw] max-w-md bg-white border rounded-2xl shadow-xl p-3 space-y-3">
          <div>
            <div class="text-xs font-semibold mb-1">Schnee (JSON)</div>
            <textarea id="snowEdit" class="w-full h-24 text-xs border rounded-xl p-2">{ "valley_cm": 20, "mountain_cm": 70, "fresh24_cm": 3, "last_snow": "2025-01-10", "quality": "griffig" }</textarea>
            <button id="saveSnow" class="mt-1 text-xs bg-slate-900 text-white px-2 py-1 rounded">Speichern</button>
          </div>
          <div>
            <div class="text-xs font-semibold mb-1">Pisten (JSON Array)</div>
            <textarea id="pistesEdit" class="w-full h-24 text-xs border rounded-xl p-2">[
  { "name": "Silleren – Adelboden (Talabfahrt)", "difficulty": "red", "status": "open", "length_km": 5.1 },
  { "name": "Geils – Bergläger", "difficulty": "blue", "status": "part", "length_km": 2.3 }
]</textarea>
            <button id="savePistes" class="mt-1 text-xs bg-slate-900 text-white px-2 py-1 rounded">Speichern</button>
          </div>
          <div>
            <div class="text-xs font-semibold mb-1">Anlagen (JSON Array)</div>
            <textarea id="liftsEdit" class="w-full h-24 text-xs border rounded-xl p-2">[
  { "name": "Oey – Bergläger", "status": "open", "from": "08:30", "to": "16:45" },
  { "name": "Bergläger – Sillerenbühl", "status": "open", "from": "08:35", "to": "16:40" }
]</textarea>
            <button id="saveLifts" class="mt-1 text-xs bg-slate-900 text-white px-2 py-1 rounded">Speichern</button>
          </div>
          <div class="text-[11px] text-slate-500">Die Eingaben werden lokal im Browser gespeichert (localStorage). Eine einzige <code>index.html</code> genügt.</div>
        </div>
      </details>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-4 space-y-4 sm:space-y-6">

    <!-- Webcams -->
    <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
      <h2 class="text-lg sm:text-xl font-semibold tracking-tight mb-3">Webcams</h2>
      <div class="grid grid-cols-1 gap-3">
        <!-- Feratel: Sillerenbühl -->
        <div class="rounded-xl overflow-hidden">
          <div class="flex items-center justify-between px-2 py-1 bg-slate-50 border-b">
            <div class="text-sm font-medium">Sillerenbühl (1974 m)</div>
            <a class="text-xs text-sky-700 underline" rel="noopener" target="_blank" href="https://webtv.feratel.com/webtv/?c0=0&c2=1&cam=4107&design=v5&lc=4107&lg=de&s=0">Quelle</a>
          </div>
          <iframe
            src="https://webtv.feratel.com/webtv/?c0=0&c2=1&cam=4107&design=v5&lc=4107&lg=de&s=0"
            width="100%" height="280" allow="autoplay; fullscreen" loading="lazy" title="Webcam Sillerenbühl (feratel)"></iframe>
        </div>
        <!-- Roundshot: Höchst (Adelboden) -->
        <div class="rounded-xl overflow-hidden">
          <div class="flex items-center justify-between px-2 py-1 bg-slate-50 border-b">
            <div class="text-sm font-medium">Höchst (Adelboden)</div>
            <a class="text-xs text-sky-700 underline" rel="noopener" target="_blank" href="https://adelbodenlenk.roundshot.com/hoechstbahn/">Quelle</a>
          </div>
          <iframe
            src="https://adelbodenlenk.roundshot.com/hoechstbahn/"
            width="100%" height="280" loading="lazy" title="Webcam Höchst (roundshot)"></iframe>
        </div>
        <!-- Feratel: Metschstand (Lenk) -->
        <div class="rounded-xl overflow-hidden">
          <div class="flex items-center justify-between px-2 py-1 bg-slate-50 border-b">
            <div class="text-sm font-medium">Metschstand (2103 m)</div>
            <a class="text-xs text-sky-700 underline" rel="noopener" target="_blank" href="https://webtv.feratel.com/webtv/?cam=4230&design=v5">Quelle</a>
          </div>
          <iframe
            src="https://webtv.feratel.com/webtv/?cam=4230&design=v5"
            width="100%" height="280" allow="autoplay; fullscreen" loading="lazy" title="Webcam Metschstand (feratel)"></iframe>
        </div>
      </div>
      <p class="mt-3 text-[11px] text-slate-500">Webcam-Quellen: Adelboden‑Lenk/feratel & roundshot. Falls ein iFrame blockiert wird, bitte den „Quelle“-Link öffnen.</p>
    </section>

    <!-- Wetter -->
    <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg sm:text-xl font-semibold tracking-tight mb-3">Wetter (Sillerenbühl)</h2>
        <span id="wxUpdated" class="text-xs px-2 py-0.5 rounded-full bg-slate-100">lädt…</span>
      </div>
      <div id="wxNow" class="grid grid-cols-3 gap-2 text-center">
        <div class="p-2">
          <div class="text-3xl font-bold" id="tempNow">–°</div>
          <div class="text-xs text-slate-500">Jetzt</div>
        </div>
        <div class="p-2">
          <div class="text-lg font-semibold" id="windNow">– m/s</div>
          <div class="text-xs text-slate-500">Wind (10 m)</div>
        </div>
        <div class="p-2">
          <div class="text-lg font-semibold" id="codeNow">–</div>
          <div class="text-xs text-slate-500">Wettercode</div>
        </div>
      </div>
      <div id="wxDaily" class="mt-3 grid grid-cols-3 gap-2"></div>
      <p class="mt-3 text-[11px] text-slate-500">Quelle: Open‑Meteo (Koordinaten: 46.4715, 7.5183; Zeitzone: Europe/Zurich).</p>
    </section>

    <!-- Tarife -->
    <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
      <h2 class="text-lg sm:text-xl font-semibold tracking-tight mb-3">Tarife</h2>
      <div class="space-y-2">
        <a class="block rounded-xl border p-3 hover:bg-slate-50" rel="noopener" target="_blank" href="https://www.adelboden-lenk.ch/tarife">
          <div class="text-sm font-semibold">Tages- & Mehrtageskarten (dynamische Preise)</div>
          <div class="text-xs text-slate-500">Offizielle Übersicht & Online‑Shop</div>
        </a>
        <a class="block rounded-xl border p-3 hover:bg-slate-50" rel="noopener" target="_blank" href="https://vogellisiberg.ch/tarife/">
          <div class="text-sm font-semibold">Einzelfahrten Sillerenbühl (Sommer)</div>
          <div class="text-xs text-slate-500">VogellisiBerg – Tal/Teilstrecken (Sommerbetrieb)</div>
        </a>
      </div>
      <p class="mt-3 text-[11px] text-slate-500">Preise können je nach Saison/Tag variieren (dynamische Preisgestaltung). Prüfe vor Ort im Webshop.</p>
    </section>

    <!-- Schneebericht -->
    <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg sm:text-xl font-semibold tracking-tight mb-3">Schneebericht</h2>
        <a class="text-xs text-sky-700 underline" rel="noopener" target="_blank" href="https://www.adelboden-lenk.ch/winter/schnee-und-pistenbericht">Offizielle Seite</a>
      </div>
      <div id="snowBox" class="grid grid-cols-2 gap-2">
        <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Tal (m ü. M.)</div><div class="text-base font-semibold" id="snowValley">–</div></div>
        <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Berg (m ü. M.)</div><div class="text-base font-semibold" id="snowMountain">–</div></div>
        <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Neuschnee (24h)</div><div class="text-base font-semibold" id="snowFresh">–</div></div>
        <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Letzter Schneefall</div><div class="text-base font-semibold" id="snowLast">–</div></div>
      </div>
      <div id="snowFallback" class="text-[12px] text-slate-500 mt-2 hidden">Kein Server nötig – die Werte werden im Code/Browser gespeichert.</div>
    </section>

    <!-- Pisten -->
    <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg sm:text-xl font-semibold tracking-tight mb-3">Pisten offen</h2>
        <a class="text-xs text-sky-700 underline" rel="noopener" target="_blank" href="https://www.adelboden-lenk.ch/winter/schnee-und-pistenbericht">Live-Pistenbericht</a>
      </div>
      <div id="pistes" class="grid grid-cols-1 gap-2"></div>
      <div id="pistesFallback" class="text-[12px] text-slate-500 mt-2 hidden">Die Daten kommen aus der eingebetteten Liste oder aus localStorage.</div>
    </section>

    <!-- Anlagen -->
    <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg sm:text-xl font-semibold tracking-tight mb-3">Geöffnete Anlagen</h2>
        <a class="text-xs text-sky-700 underline" rel="noopener" target="_blank" href="https://adelboden-lenk-kandersteg.ch/en/timetables">Live-Anzeige öffnen</a>
      </div>
      <div id="lifts" class="grid grid-cols-1 gap-2"></div>
      <div id="liftsFallback" class="text-[12px] text-slate-500 mt-2 hidden">Die Daten kommen aus der eingebetteten Liste oder aus localStorage.</div>
    </section>

    <!-- Footer -->
    <footer class="pb-8 pt-2 text-center text-[11px] text-slate-500">
      Reines HTML/JS. Keine Cookies, keine Server‑Side Logik. · © Dein Projekt · Quellen: offizielle Websites von Adelboden‑Lenk & Open‑Meteo.
    </footer>
  </main>

  <script>
    // ===== Config =====
    const CFG = {
      lat: 46.4715,
      lon: 7.5183,
      tz: 'Europe/Zurich',
      demo: new URLSearchParams(location.search).get('demo') === '1'
    };

    // ===== Embedded data (keine externen JSON-Dateien nötig) =====
    // Du kannst die Inhalte hier im Code anpassen oder über den Editor (⚙️) speichern (localStorage).
    let DATA = {
      snow: { valley_cm: 20, mountain_cm: 70, fresh24_cm: 3, last_snow: '2025-01-10', quality: 'griffig' },
      pistes: [
        { name: 'Silleren – Adelboden (Talabfahrt)', difficulty: 'red', status: 'open', length_km: 5.1 },
        { name: 'Geils – Bergläger', difficulty: 'blue', status: 'part', length_km: 2.3 },
        { name: 'Hahnenmoos – Geils', difficulty: 'red', status: 'closed', length_km: 3.4 }
      ],
      lifts: [
        { name: 'Oey – Bergläger', status: 'open', from: '08:30', to: '16:45' },
        { name: 'Bergläger – Sillerenbühl', status: 'open', from: '08:35', to: '16:40' },
        { name: 'Geils – Hahnenmoos', status: 'pause', from: '09:00', to: '16:30' }
      ]
    };

    // Load custom data from localStorage if present
    try {
      const s = localStorage.getItem('adelboden_snow');
      const p = localStorage.getItem('adelboden_pistes');
      const l = localStorage.getItem('adelboden_lifts');
      if (s) DATA.snow = JSON.parse(s);
      if (p) DATA.pistes = JSON.parse(p);
      if (l) DATA.lifts = JSON.parse(l);
    } catch(err) { /* ignore */ }

    // ===== Weather via Open-Meteo (CORS-friendly) =====
    async function loadWeather() {
      const url = new URL('https://api.open-meteo.com/v1/forecast');
      url.search = new URLSearchParams({
        latitude: CFG.lat,
        longitude: CFG.lon,
        current: 'temperature_2m,wind_speed_10m,weather_code',
        daily: 'temperature_2m_max,temperature_2m_min,precipitation_sum',
        forecast_days: '5',
        timezone: CFG.tz
      }).toString();
      try {
        const res = await fetch(url);
        const data = await res.json();
        const { current, daily } = data;

        document.getElementById('tempNow').textContent = `${Math.round(current.temperature_2m)}°C`;
        document.getElementById('windNow').textContent = `${Math.round(current.wind_speed_10m)} m/s`;
        document.getElementById('codeNow').textContent = `WMO ${current.weather_code}`;
        document.getElementById('wxUpdated').textContent = new Date().toLocaleTimeString('de-CH', { hour: '2-digit', minute: '2-digit' });

        const daysEl = document.getElementById('wxDaily');
        daysEl.innerHTML = '';
        for (let i = 0; i < daily.time.length; i++) {
          const d = daily.time[i];
          const max = Math.round(daily.temperature_2m_max[i]);
          const min = Math.round(daily.temperature_2m_min[i]);
          const pr = Math.round(daily.precipitation_sum[i] || 0);
          const date = new Date(d);
          const dd = date.toLocaleDateString('de-CH', { weekday: 'short' });
          const card = document.createElement('div');
          card.className = 'rounded-xl border p-2 text-center';
          card.innerHTML = `<div class="text-xs text-slate-500">${dd}</div>
                            <div class="text-base font-semibold">${max}° / ${min}°</div>
                            <div class="text-[11px] text-slate-500">Niederschlag: ${pr} mm</div>`;
          daysEl.appendChild(card);
        }
      } catch(err) {
        document.getElementById('wxUpdated').textContent = 'offline';
      }
    }

    // ===== Snow report: use embedded or locally saved data =====
    async function loadSnow() {
      const set = (id, val) => document.getElementById(id).textContent = val ?? '–';
      try {
        const data = DATA.snow;
        set('snowValley', `${data.valley_cm ?? '–'} cm`);
        set('snowMountain', `${data.mountain_cm ?? '–'} cm`);
        set('snowFresh', `${data.fresh24_cm ?? '–'} cm`);
        set('snowLast', data.last_snow ? new Date(data.last_snow).toLocaleDateString('de-CH') : '–');
      } catch(e) {
        document.getElementById('snowFallback').classList.remove('hidden');
      }
    }

    // ===== Pistes: use embedded or locally saved data =====
    async function loadPistes() {
      renderPistes(DATA.pistes);
    }
    function renderPistes(list) {
      const box = document.getElementById('pistes');
      box.innerHTML = '';
      list.forEach(p => {
        const statusColor = p.status === 'open' ? 'bg-emerald-100 text-emerald-700' : p.status === 'part' ? 'bg-amber-100 text-amber-700' : 'bg-rose-100 text-rose-700';
        const difficulty = p.difficulty === 'blue' ? '🔵' : p.difficulty === 'red' ? '🔴' : '⚫';
        const row = document.createElement('div');
        row.className = 'rounded-xl border p-3 flex items-center justify-between gap-3';
        row.innerHTML = `
          <div>
            <div class="text-sm font-semibold">${difficulty} ${p.name}</div>
            <div class="text-[11px] text-slate-500">${p.length_km ? `${Number(p.length_km).toFixed(1)} km` : ''}</div>
          </div>
          <span class="text-xs px-2 py-0.5 rounded-full ${statusColor}">${p.status}</span>
        `;
        box.appendChild(row);
      });
    }

    // ===== Lifts: use embedded or locally saved data =====
    async function loadLifts() {
      renderLifts(DATA.lifts);
    }
    function renderLifts(list) {
      const box = document.getElementById('lifts');
      box.innerHTML = '';
      list.forEach(item => {
        const color = item.status === 'open' ? 'bg-emerald-100 text-emerald-700' : item.status === 'pause' ? 'bg-amber-100 text-amber-700' : 'bg-rose-100 text-rose-700';
        const row = document.createElement('div');
        row.className = 'rounded-xl border p-3 flex items-center justify-between gap-3';
        row.innerHTML = `
          <div>
            <div class="text-sm font-semibold">${item.name}</div>
            <div class="text-[11px] text-slate-500">${item.from ? `${item.from}–${item.to}` : '—'}</div>
          </div>
          <span class="text-xs px-2 py-0.5 rounded-full ${color}">${item.status}</span>
        `;
        box.appendChild(row);
      });
    }

    // ===== Init =====
    async function init() {
      await Promise.allSettled([
        loadWeather(),
        loadSnow(),
        loadPistes(),
        loadLifts()
      ]);
    }
    document.getElementById('refreshBtn').addEventListener('click', (e) => {
      e.preventDefault();
      init();
    });
    init();

    // ===== Inline editor logic (localStorage) =====
    (function bootEditor(){
      const snowArea = document.getElementById('snowEdit');
      const pistesArea = document.getElementById('pistesEdit');
      const liftsArea = document.getElementById('liftsEdit');
      if (!snowArea || !pistesArea || !liftsArea) return;
      try {
        snowArea.value = JSON.stringify(DATA.snow, null, 2);
        pistesArea.value = JSON.stringify(DATA.pistes, null, 2);
        liftsArea.value = JSON.stringify(DATA.lifts, null, 2);
      } catch(err) {}
      const qs = (s) => document.getElementById(s);
      qs('saveSnow').addEventListener('click', () => {
        try { const obj = JSON.parse(snowArea.value); DATA.snow = obj; localStorage.setItem('adelboden_snow', JSON.stringify(obj)); loadSnow(); } catch(e){ alert('Ungültiges JSON Schnee'); }
      });
      qs('savePistes').addEventListener('click', () => {
        try { const obj = JSON.parse(pistesArea.value); DATA.pistes = obj; localStorage.setItem('adelboden_pistes', JSON.stringify(obj)); loadPistes(); } catch(e){ alert('Ungültiges JSON Pisten'); }
      });
      qs('saveLifts').addEventListener('click', () => {
        try { const obj = JSON.parse(liftsArea.value); DATA.lifts = obj; localStorage.setItem('adelboden_lifts', JSON.stringify(obj)); loadLifts(); } catch(e){ alert('Ungültiges JSON Anlagen'); }
      });
    })();
  </script>
</body>
</html>
