<!doctype html>
<html lang="de" class="h-full bg-cyan-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adelboden-Lenk • Sillerenbühl – Überblick</title>
  <meta name="description" content="Mobile Übersicht für Adelboden-Lenk (Sillerenbühl): Webcams, Wetter, Tarife, Anlagen, Schnee, Pisten." />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full text-slate-900 bg-cyan-50">
<header class="sticky top-0 bg-cyan-100/80 border-b border-cyan-200 z-40 backdrop-blur">
  <div class="max-w-3xl mx-auto px-4 py-2 flex items-center gap-3 relative">
    <div class="w-8 h-8 rounded-xl bg-cyan-200 flex items-center justify-center">⛷️</div>
    <div class="flex-1">
      <div class="text-sm font-semibold leading-tight">Adelboden‑Lenk • Sillerenbühl</div>
      <div class="text-xs text-slate-600">Webcams · Wetter · Tarife · Anlagen · Schnee · Pisten</div>
    </div>
    <a href="#" id="refreshBtn" class="text-xs bg-cyan-700 text-white px-3 py-1 rounded-full">Aktualisieren</a>
    <details class="ml-2">
      <summary class="text-xs cursor-pointer px-2 py-1 rounded-full border">⚙️ Daten</summary>
      <div class="absolute right-2 mt-2 w-[92vw] max-w-md bg-white border rounded-2xl shadow-xl p-3 space-y-3">
        <div>
          <div class="text-xs font-semibold mb-1">Tarife (JSON Array)</div>
          <textarea id="tariffEdit" class="w-full h-24 text-xs border rounded-xl p-2">[
  { "date": "2025-09-27", "label": "Sa 27.09", "from_chf": 72, "link": "https://www.adelboden-lenk.ch/tarife" },
  { "date": "2025-09-28", "label": "So 28.09", "from_chf": 68, "link": "https://www.adelboden-lenk.ch/tarife" },
  { "date": "2025-09-29", "label": "Mo 29.09", "from_chf": 65, "link": "https://www.adelboden-lenk.ch/tarife" }
]</textarea>
          <button id="saveTariff" class="mt-1 text-xs bg-cyan-700 text-white px-2 py-1 rounded">Speichern</button>
        </div>
        <div>
          <div class="text-xs font-semibold mb-1">meteoblue Widget HTML</div>
          <textarea id="mbEmbed" class="w-full h-20 text-xs border rounded-xl p-2" placeholder="meteoblue Widget-Code hier einfügen"></textarea>
          <button id="saveMB" class="mt-1 text-xs bg-cyan-700 text-white px-2 py-1 rounded">meteoblue speichern</button>
        </div>
      </div>
    </details>
  </div>
</header>

<main class="max-w-3xl mx-auto px-4 py-4 space-y-4 sm:space-y-6">

  <!-- Wetter -->
  <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold mb-3 text-cyan-800">Wetter</h2>
      <span id="wxUpdated" class="text-xs px-2 py-0.5 rounded-full bg-cyan-100">lädt…</span>
    </div>
    <div id="mbWidget" class="rounded-xl overflow-hidden border mb-3 hidden"></div>
    <p id="mbHint" class="text-[11px] text-slate-500 hidden">Quelle: meteoblue Widget.</p>
    <div id="wxFallback">
      <div id="wxNow" class="grid grid-cols-3 gap-2 text-center">
        <div><div class="text-3xl font-bold" id="tempNow">–°</div><div class="text-xs text-slate-500">Jetzt</div></div>
        <div><div class="text-lg font-semibold" id="windNow">– m/s</div><div class="text-xs text-slate-500">Wind</div></div>
        <div><div class="text-lg font-semibold" id="codeNow">–</div><div class="text-xs text-slate-500">Wettercode</div></div>
      </div>
      <div id="wxDaily" class="mt-3 grid grid-cols-3 gap-2"></div>
    </div>
  </section>

  <!-- Tarife -->
  <section class="bg-white rounded-2xl shadow-md p-4 sm:p-6">
    <h2 class="text-lg font-semibold mb-3 text-cyan-800">Tarife nächste 3 Tage</h2>
    <div id="tariffs" class="grid grid-cols-1 gap-2"></div>
  </section>

</main>

<script>
let DATA = {
  tariffs: [
    { date: "2025-09-27", label: "Sa 27.09", from_chf: 72, link: "https://www.adelboden-lenk.ch/tarife" },
    { date: "2025-09-28", label: "So 28.09", from_chf: 68, link: "https://www.adelboden-lenk.ch/tarife" },
    { date: "2025-09-29", label: "Mo 29.09", from_chf: 65, link: "https://www.adelboden-lenk.ch/tarife" }
  ]
};

function renderMBWidget() {
  const html = localStorage.getItem('mb_widget_html');
  const box = document.getElementById('mbWidget');
  const hint = document.getElementById('mbHint');
  const fb = document.getElementById('wxFallback');
  if (html && html.trim()) {
    box.innerHTML = html;
    box.classList.remove('hidden');
    hint.classList.remove('hidden');
    fb.classList.add('hidden');
    document.getElementById('wxUpdated').textContent = 'meteoblue';
  } else {
    box.classList.add('hidden');
    hint.classList.add('hidden');
    fb.classList.remove('hidden');
  }
}

function renderTariffs() {
  const list = DATA.tariffs;
  const box = document.getElementById('tariffs');
  box.innerHTML = '';
  list.forEach(t => {
    const row = document.createElement('a');
    row.href = t.link; row.target = '_blank';
    row.className = 'rounded-xl border p-3 flex items-center justify-between hover:bg-cyan-50';
    row.innerHTML = `<div><div class="text-sm font-semibold">${t.label}</div><div class="text-[11px] text-slate-500">ab CHF ${t.from_chf}</div></div><span class="text-xs bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded-full">Ticket</span>`;
    box.appendChild(row);
  });
}

document.getElementById('refreshBtn').addEventListener('click', e => { e.preventDefault(); renderMBWidget(); renderTariffs(); });

(function bootEditor(){
  const tariffsArea = document.getElementById('tariffEdit');
  const mbArea = document.getElementById('mbEmbed');
  try { tariffsArea.value = JSON.stringify(DATA.tariffs, null, 2);} catch(e){}
  try { const s = localStorage.getItem('mb_widget_html'); if (s) mbArea.value = s; } catch(e){}
  document.getElementById('saveTariff').addEventListener('click', () => {
    try { const obj = JSON.parse(tariffsArea.value); DATA.tariffs = obj; localStorage.setItem('tariffs', JSON.stringify(obj)); renderTariffs(); } catch(e){ alert('Ungültiges JSON Tarife'); }
  });
  document.getElementById('saveMB').addEventListener('click', () => {
    try { localStorage.setItem('mb_widget_html', mbArea.value); renderMBWidget(); } catch(e){ alert('Konnte meteoblue Widget nicht speichern'); }
  });
})();

renderMBWidget();
renderTariffs();
</script>

</body>
</html>